<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.544">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pedro J. Aphalo with Marcel A. K. Jansen">
<meta name="dcterms.date" content="2023-11-16">

<title>BTV 2ed</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Preliminary-plan-2ed_files/libs/clipboard/clipboard.min.js"></script>
<script src="Preliminary-plan-2ed_files/libs/quarto-html/quarto.js"></script>
<script src="Preliminary-plan-2ed_files/libs/quarto-html/popper.min.js"></script>
<script src="Preliminary-plan-2ed_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Preliminary-plan-2ed_files/libs/quarto-html/anchor.min.js"></script>
<link href="Preliminary-plan-2ed_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Preliminary-plan-2ed_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Preliminary-plan-2ed_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Preliminary-plan-2ed_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Preliminary-plan-2ed_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">BTV 2ed</h1>
<p class="subtitle lead">Preliminary plan</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Pedro J. Aphalo with Marcel A. K. Jansen </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 16, 2023</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">February 15, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<p><em>This is how we imagine the 2ed of Beyond the Visible. Edited by Pedro based on feedback from Marcel and earlier exchanges of ideas with Eva Rosenqvist and Matt Robson, as well as comments from chapter authors from the first edition.</em></p>
<p>In the list below, author names followed by a question mark indicate that I have not yet asked them to contribute or that they haven’t yet given a definitive answer. Otherwise, authors have agreed to update or contribute new material to the respective sections. In my case, I have added my name to those sections to which I would be able to contribute if needed, but this does not mean that this will be needed or important.</p>
<p>Two biggest changes for the second edition are the scope, and how to prepare the manuscript and publish it.</p>
<p>The idea is to cover a broader range of wavelengths. This is mainly Pedro own idea, as Marcel prefers to focus on UV (UV-A, UV-B and possibly? UV-C)<em>. Pedro thinks, however, that this expansion is very much needed, and does not necessarily require much more work than focusing on UV alone. Even if focusing on UV, other wavelengths would still have to be included in relation to the growing environment and interactions with UV. Pedro’s reasoning is, 1) that we now know for sure that all responses to UV depend on the spectrum as a whole, and 2) including VIS and NIR (FR) could expand the audience/readership many fold.</em></p>
<p>Main change about the publication approach that we propose is to publish an open access version on-line as HTML files (web pages) and a printed version commercially, if possible. We would start with the on-line version, and publish chapter by chapter when they are “presentable” but not necessarily in their final shape. To make this possible, we need a system that can produce from the same manuscript files the on-line and printed-book versions automatically and using a file format for writing that is agnostic about Windows, Unix (X) or Linux and fairly easy to use by authors.</p>
<p>I suggest that we use Quarto, which is based on markdown and for which RStudio can be used as a source and/or visual editor. There is no need to learn R or many commands, for example <code>**bold**</code> results in <strong>bold</strong> and <code>_italics_</code> in <em>italics</em>. The visual editing mode works like <em>Word</em> but with a much more limited set of commands. There is quite good documentation for <a href="https://quarto.org/docs/guide/">Quarto</a>, although a lot of it is irrelevant to our planned use. Simplest for authors would be to use the visual editor in RStudio. This is all free software.</p>
<p>I have tried a translator program called <em>pandoc</em> to convert the LaTeX source of the first edition into markdown, and it worked well for the text. So after a bit of manual clean-up this could be used as a starting point for revising existing text. I do have all the original illustrations from the first edition.</p>
<section id="handbook-2ed-title" class="level1">
<h1>Handbook 2ed Title</h1>
<p>Suggestions, for a possible book title</p>
<ol type="1">
<li><p><em>Field Methods in Plant Photobiology: From Principles to Practice (liked by Marcel, and preferred by Pedro)</em></p></li>
<li><p><em>Plant Photobiology: Recomended Practices and Field Methods</em></p></li>
<li><p>I would avoid resuing “Beyond the Visible” because of the Google search results for it. Starting with many pages of links related a film about Hilma af Klint released in 2019, of which I’ve watched only the trailer, but looks very very interesting!</p>
<p><a href="https://www.google.com/search?q=%22Beyond+the+Visible%22" class="uri">https://www.google.com/search?q=%22Beyond+the+Visible%22</a></p></li>
</ol>
</section>
<section id="scope" class="level1">
<h1>Scope</h1>
<ul>
<li><p>Wavelength scope: 280–900 nm (expanded to include VIS and FR).</p></li>
<li><p>Exclude methods used at the lab bench (as in first edition). <em>The aim is to avoid making the book too long. One could, if editors are available for a second volume, consider producing two volumes, with the plan shown here for volume 1, and a separate volume 2, with metabolomics, ROS-related assays, molecular biology and bioinformatics.</em></p></li>
<li><p>Include gas-exchange and chlorophyll fluorescence (we have Wolgang, Eva, Otmar and also Alexey Shapiguzov as possible authors).</p></li>
<li><p>Actual computations</p>
<ul>
<li><p>My R packages can be used for many calculations relevant to the book. They will greatly simplify the production of many of the illustrations. However, I would rather keep the details of the R code out of BTV2 so that it does not become bloated.</p></li>
<li><p>The details of the use of the R packages for photobiology will go into a separate book, for which I already have a partial manuscript.</p></li>
</ul></li>
</ul>
</section>
<section id="editors" class="level1">
<h1>Editors</h1>
<ul>
<li><p>Pedro Aphalo</p></li>
<li><p>Marcel Jansen</p></li>
<li><p>Wolgang Bilger (?)</p></li>
<li><p>Eva Rosenqvist (?)</p></li>
</ul>
</section>
<section id="publisher" class="level1">
<h1>Publisher</h1>
<ul>
<li><p>UV4Plants as web site, even pre-release chapter by chapter. (This would include publishing on-line advanced drafts for comments.)</p></li>
<li><p>CRC/Taylor &amp; Francis (if possible, in parallel with the open-access web site, they showed interest when I contacted them)</p></li>
<li><p>other?</p></li>
</ul>
</section>
<section id="chapters-for-2nd-edition" class="level1">
<h1>Chapters for 2nd edition</h1>
<dl>
<dt>1. Radiation and optics</dt>
<dd>
<p>Previously: <em>Introduction / would remain broad and introductory</em></p>
<ol type="1">
<li><p>Make the text more accessible to those not-mathematically minded. (Pedro + LOB + Andreas Albert (? at least reuse allowed) + Ylianttila (?))</p></li>
<li><p>Update colour definitions to follow ISO/CIE. (Pedro)</p></li>
<li><p>Update the present discussion on the different quantities, and their variations. (Pedro)</p></li>
<li><p>Describe light sources with different emission geometries, and irradiance vs.&nbsp;distance consequences. (Point sources vs.&nbsp;other sources, would expand diffuse vs.&nbsp;collimated light discussion.) (Pedro)</p></li>
<li><p>Discuss reflectance vs.&nbsp;angle of incidence. (Pedro + LOB)</p></li>
<li><p>Discuss the mechanisms behind fluorescence and luminiscence. (Pedro + LOB + Alexey)</p></li>
<li><p>A short list of key terms, with explanations, possibly as tables as in first edition.</p></li>
<li><p><em>Move discussion of radiation in the environment to new chapter 2.</em></p></li>
</ol>
</dd>
<dt>2. The UV, VIS and NIR in the environment of plants</dt>
<dd>
<p>New chapter.</p>
<ol type="1">
<li><p>The climatology UV and VIS. Including up-to-date maps. (Daniele Griffoni + Anders Lindfors)</p></li>
<li><p>Latitudinal and diurnal variation in UV, VIS and NIR spectrum (Pedro + Max + ?)</p></li>
<li><p>Discuss in depth waveband ratios in nature (Pedro + Matt?).</p></li>
<li><p>Computing the position of the sun and day/night length (Pedro).</p></li>
<li><p>DLI daily light integral (Titta Kotilainen (?))</p></li>
<li><p>Discuss light distribution and sunflecks in canopies (Maxime Durand + Matt)</p></li>
<li><p>Update and expand text on light in aquatic environments. (Pirjo Huovinen + Ivan Gómez?)</p></li>
</ol>
</dd>
<dt>3. Plants and light</dt>
<dd>
<p>New chapter. (This chapter is where including visible radiation has most impact)</p>
</dd>
<dd>
<ol type="1">
<li><p>A brief introduction to light sensing by plants? (Luis Morales + Neha Rai+ Jorge Casal?)</p></li>
<li><p>Photosynthesis (Wolfgang (?) + Alexey Shapiguzov)</p></li>
<li><p>Stress and damage (Marcel + Éva Hideg (?))</p></li>
<li><p>Temperature and energy balance (Pedro)</p></li>
</ol>
</dd>
<dt>4. Design, planning and data analysis from photobiological experiments</dt>
<dd>
<p>Previously: <em>Design of photobiological experiments</em></p>
<ol type="1">
<li><p>Field and controlled experiments (New, Pedro + Marcel)</p></li>
<li><p>Statistical aspects (Pedro, not much to do. Add MA regression (and quantile regression + deepest curve.) <em>This was in the first edition, mainly related to design, pseudoreplication and the correspondence between design and matching statistical models.</em></p></li>
<li><p>Sampling procedures for laboratory analyses (Pedro?, Neha?, Luis? Nina?)</p></li>
<li><p>Bases of expression for concentrations (Pedro + Nina?) <em>Answer to Marcel’s comment: I have noticed that most reviews about phenolics, make no distinction between concentrations expressed per unit area, unit dry mass or unit fresh mass. This makes, however, a huge difference as SLA and tissue water content can change (and a lot) in response to light and UV treatments.</em></p></li>
</ol>
</dd>
<dt>5. Plant cultivation</dt>
<dd>
<p>Previously: <em>Plant cultivation</em></p>
<ol type="1">
<li><p>Cultivation of terrestrial plants in controlled environments (Eva Rosenqvist + Pedro)</p></li>
<li><p>Cultivation of terrestrial plants outdoors (Víctor Sadras? + Otmar Urban? + Pedro)</p></li>
<li><p>Weather stations and WMO requirements (Pedro ?).</p></li>
<li><p>Cultivation of aquatic plants (Marcel + Pirjo huovinen)</p></li>
<li><p>Guidelines for reporting plant-growing conditions (Pedro + Titta + Eva Rosenqvist) To Marcel: I would base this on existing published guidelines, adjusted for research on light and UV. <a href="https://www.controlledenvironments.org/" class="uri">https://www.controlledenvironments.org/</a></p>
<p><a href="https://www.controlledenvironments.org/wp-content/uploads/sites/6/2017/05/Greenhouse-Guidelines.pdf" class="uri">https://www.controlledenvironments.org/wp-content/uploads/sites/6/2017/05/Greenhouse-Guidelines.pdf</a></p>
<p><a href="https://www.controlledenvironments.org/wp-content/uploads/sites/6/2017/06/Minimum-Guidelines-Brochure-version-A4.pdf" class="uri">https://www.controlledenvironments.org/wp-content/uploads/sites/6/2017/06/Minimum-Guidelines-Brochure-version-A4.pdf</a></p>
<p>WMO has a “Guide to Instruments and Methods of Observation Volume I –Measurement of Meteorological Variables” that is nearly 600 pages long, but could be useful to write some guidelines for weather, including radiation, measurements outdoors, and to check symbols and definitions of variables.</p></li>
</ol>
</dd>
<dt>6. Manipulating UV and VIS radiation</dt>
<dd>
<p>Previosuly: <em>Manipulating UV radiation</em></p>
<ol type="1">
<li><p>Update safety considerations to address current regulations and recommendations (including blue light).</p></li>
<li><p>Incandescent and quartz halogen lamps, etc.</p></li>
<li><p>Discharge lamps, including Xenon flash, etc.</p></li>
<li><p>Expand material on LEDs, including approaches to dimming and pulse generation. (Pedro + Alan Morrison)</p></li>
<li><p>Controlling diffuse vs.&nbsp;direct light from artificial sources: Lenses, reflectors, honeycomb grids and other modifiers (Pedro).</p></li>
<li><p>Pulsed vs.&nbsp;steady irradiance with LEDs, fluorescent tubes, and incandescent lamps.</p></li>
<li><p>Update on films and filters needed (expand on the effect of angle of incidence)</p></li>
<li><p>Greenhouse cladding (glass, films, PMM, PC, etc.)</p></li>
<li><p>Greenhouse screens, nets and covers (based on spectral data from Matthew Robson and Titta Kotilainen)</p></li>
</ol>
</dd>
<dt>7. Quantifying UV and VIS radiation</dt>
<dd>
<p>Previously: <em>Quantifying UV radiation</em></p>
<ol type="1">
<li><p>Start with broad-band, narrow-band vs.&nbsp;spectrometers.</p></li>
<li><p>Update information on input optics for spectrometers (new shapes, and performance). (Pedro)</p></li>
<li><p>Temperature dependence of calibrations of spectrometers (wavelength and response).</p></li>
<li><p>Temperature dependence of dark noise, and dark references.</p></li>
<li><p>Expand response spectrum of broadband sensors (examples of errors, PAR, ePAR, R, FR, UVA1, UVA2, UVB, pyranometers).</p></li>
<li><p>ePAR vs.&nbsp;PAR (Pedro)</p></li>
<li><p>R:(R + FR) vs.&nbsp;R:FR (Pedro)</p></li>
<li><p>Add computations for Pfr:Ptot photoequilibrium and photocycling. (if possible also CRY with blue:green) (Pedro)</p></li>
<li><p>Update equipment examples to those currently available. (Pedro)</p></li>
<li><p>Simulation of the solar spectrum (Anders Lindfors / Maxim Durand + Pedro)</p></li>
</ol>
</dd>
<dt>8. Imaging in UV, VIS and NIR</dt>
<dd>
<p>Possible new chapter.</p>
<ol type="1">
<li><p>Still, video and time lapse imaging as research tools (Pedro + Eva).</p></li>
<li><p>Cameras, lenses (Pedro + Ylianttila?).</p></li>
<li><p>Camera Filters, etc., (Pedro)</p></li>
<li><p>Multispectral and hyperspectral imaging (Pedro + Alexey Shapiguzov?).</p></li>
<li><p>UV induced VIS and NIR fluorescence and VIS induced NIR fluorescence (Pedro + Ylianttila + Alexey Shapiguzov (?)).</p></li>
<li><p>Image editing (Eva + Pedro).</p>
<p>a. White balance, noise reduction, contrast enhancement.</p>
<p>b. Multi-image methods: HDR, focus stacking, panoramas</p>
<p>c. Colour profiles and light sources.</p>
<p>d. Limits to image editing when images are used as scientific evidence.</p></li>
</ol>
</dd>
<dt>9. Measurement of optical properties of leaves and materials</dt>
<dd>
<p>New chapter.</p>
<ol type="1">
<li><p>Epidermal transmittance, etc. (Wolfgang Bilger + Paul Barnes (?))</p></li>
<li><p>Reflectance and transmittance of whole leaves (and flowers?) (Matt? + Pedro + Luis (Albert’s group)). Include discussion on black references.</p></li>
<li><p>Filters, etc., (Pedro)</p></li>
<li><p>Fluorescence of leaves (and glass filters!) (Pedro + Alexey Shapiguzov?).</p></li>
<li><p>Optical measurement of chloroplast accumulation (Justyna (?) + Pawel (?))</p></li>
<li><p>In-situ measurement of plant pigments (Dualex, etc.) (Matt? + Wolfgang + Marcel?).</p></li>
<li><p><del>Measurements of extracted plant pigments (Wolfgang Bilger + Nina Siipari + Susanne + Pedro?)</del></p></li>
</ol>
</dd>
<dt>10. Plant phenotyping for the crowds</dt>
<dd>
<p>New chapter.</p>
<ol type="1">
<li><p>Introduction to image analysis with ImageJ (Fang Wang + Pedro).</p></li>
<li><p>Using AI and ML approaches (Pedro + ?).</p></li>
<li><p>Thermal imagining (Pedro + ?).</p></li>
<li><p>Growth analysis, simple introduction (Pedro)</p></li>
<li><p>Porometry (Maxime? + Pedro + Eva?).</p></li>
<li><p>Gas-exchange (Alexey + Eva? + Pedro).</p></li>
<li><p>Chlorophyll fluorescence (Eva + Wolfgang? + Alexey).</p></li>
</ol>
</dd>
<dt>11. Data acquisition and logging</dt>
<dd>
<p>New chapter.</p>
<ol type="1">
<li><p>Examples of modern dataloggers, large and small (Pedro + Eva?).</p></li>
<li><p>IOT (Internet of Things) (Alan? + Alexis Dowhuszko?)</p></li>
<li><p>Communication protocols (USB, Wifi, USB, LORA, etc) (Alexis Dowhuszko? + Pedro? + Alan?).</p></li>
<li><p>Protocols SDI-12 and “intelligent sensors” (Pedro + Alan?).</p></li>
<li><p>Time coordinates (Pedro).</p></li>
<li><p>On-line weather and climate data sources (Pedro + Maxime Durand).</p></li>
<li><p>On-line sources of UV, VIS, and NIR irradiance estimates based on satellite sensing (FMI, Kaisa).</p></li>
<li><p>Remote sensing of pigments and photosynthesis (Albert Porcar et al.&nbsp;?)</p></li>
</ol>
</dd>
<dt>12. Ensuring reproducibility (Pedro? + ?)</dt>
<dd>
<p>New chapter.</p>
<ol type="1">
<li><p>Reporting of materials and methods</p></li>
<li><p>Sharing of data</p></li>
<li><p>Reproducibility of data analyses</p></li>
<li><p>Reproducibilty checklist for authors, reviewers and editors</p></li>
</ol>
</dd>
</dl>
<p>Appendixes</p>
<ol type="1">
<li><p>Further reading</p></li>
<li><p>Software</p></li>
<li><p>Suppliers</p></li>
<li><p>Glossary</p></li>
</ol>
</section>
<section id="material-that-could-be-edited-and-re-used" class="level1">
<h1>Material that could be edited and re-used</h1>
<p>From the Bulletin: <a href="https://doi.org/10.19232/uv4pb.2020.1.24" class="uri">https://doi.org/10.19232/uv4pb.2020.1.24</a>, <a href="https://doi.org/10.19232/uv4pb.2020.1.12" class="uri">https://doi.org/10.19232/uv4pb.2020.1.12</a>, <a href="https://doi.org/10.19232/uv4pb.2020.1.25" class="uri">https://doi.org/10.19232/uv4pb.2020.1.25</a>, <a href="https://doi.org/10.19232/uv4pb.2016.1.14" class="uri">https://doi.org/10.19232/uv4pb.2016.1.14</a>, <a href="https://doi.org/10.19232/uv4pb.2019.1.15" class="uri">https://doi.org/10.19232/uv4pb.2019.1.15</a>, <a href="https://doi.org/10.19232/uv4pb.2019.1.30" class="uri">https://doi.org/10.19232/uv4pb.2019.1.30</a>, <a href="https://doi.org/10.19232/uv4pb.2018.1.12" class="uri">https://doi.org/10.19232/uv4pb.2018.1.12</a>, <a href="https://doi.org/10.19232/uv4pb.2018.2.14" class="uri">https://doi.org/10.19232/uv4pb.2018.2.14</a>, <a href="https://doi.org/10.19232/uv4pb.2016.2.11" class="uri">https://doi.org/10.19232/uv4pb.2016.2.11</a>.</p>
<p>From my web site on photography: <a href="https://www.photo-spectrum.info/pages/filters/UV-filters.html" class="uri">https://www.photo-spectrum.info/pages/filters/UV-filters.html</a>, <a href="https://www.photo-spectrum.info/pages/filters/NIR-filters.html" class="uri">https://www.photo-spectrum.info/pages/filters/NIR-filters.html</a>, <a href="https://www.photo-spectrum.info/pages/filters/uvir-cut-filters.html" class="uri">https://www.photo-spectrum.info/pages/filters/uvir-cut-filters.html</a>, <a href="https://www.photo-spectrum.info/pages/filters/uv-cut-filters.html" class="uri">https://www.photo-spectrum.info/pages/filters/uv-cut-filters.html</a>, <a href="https://www.photo-spectrum.info/pages/filters/UV-filter-stacks.html" class="uri">https://www.photo-spectrum.info/pages/filters/UV-filter-stacks.html</a>, and possibly other posts with some reusable bits. This whole site as well as <a href="https://www.r4photobiology.info/" class="uri">https://www.r4photobiology.info/</a> have only static content and are built using Quarto. The on-line book could be similar in relation to features, but the styling and design could be different if desired.</p>
<p>From my research-group blog: <a href="https://blogs.helsinki.fi/senpep-blog/2022/12/the-earth-is-not-flat-are-plants-and-plant-canopies-flat/" class="uri">https://blogs.helsinki.fi/senpep-blog/2022/12/the-earth-is-not-flat-are-plants-and-plant-canopies-flat/</a>, <a href="https://blogs.helsinki.fi/senpep-blog/2021/10/bright-times-for-our-growth-chambers/" class="uri">https://blogs.helsinki.fi/senpep-blog/2021/10/bright-times-for-our-growth-chambers/</a>, <a href="https://blogs.helsinki.fi/senpep-blog/2018/05/visible-and-uv-a-radiation-in-greenhouses/" class="uri">https://blogs.helsinki.fi/senpep-blog/2018/05/visible-and-uv-a-radiation-in-greenhouses/</a>, <a href="https://blogs.helsinki.fi/senpep-blog/page/4/" class="uri">https://blogs.helsinki.fi/senpep-blog/page/4/</a>.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>