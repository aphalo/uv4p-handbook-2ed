<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.544">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Radiation and Optics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="BTV2-radiaition-and-optics_files/libs/clipboard/clipboard.min.js"></script>
<script src="BTV2-radiaition-and-optics_files/libs/quarto-html/quarto.js"></script>
<script src="BTV2-radiaition-and-optics_files/libs/quarto-html/popper.min.js"></script>
<script src="BTV2-radiaition-and-optics_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="BTV2-radiaition-and-optics_files/libs/quarto-html/anchor.min.js"></script>
<link href="BTV2-radiaition-and-optics_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="BTV2-radiaition-and-optics_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="BTV2-radiaition-and-optics_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="BTV2-radiaition-and-optics_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="BTV2-radiaition-and-optics_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Radiation and Optics</h1>
<p class="subtitle lead">From BTV1 Intro translated to Quarto</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="wavelength-and-colour" class="level2">
<h2 class="anchored" data-anchor-id="wavelength-and-colour">Wavelength and Colour</h2>
<p>Radiation can be described as waves, with wavelength or frequency as properties, or based on quantum physics, as photons of specific energy. This “double personality” of light is important as each viewpoint provides a simpler explanation for different phenomena, such as refraction and reflection at boundaries between materials and absorption of radiation by pigments and other molecules. From the first perspective, ultraviolet (UV), visible (VIS), and infrared (IR) radiation are electromagnetic waves and are described by the Maxwell’s equations.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> From the second perspective, Plank’s law describes the energy of a quantum as inversely proportional to wavelength.</p>
<p>The wavelength ranges of visible radiation, described by their colour based on human vision, are shown in <a href="#fig-wavebands-short" class="quarto-xref">Figure&nbsp;1</a>. The colour ranges indicated in <a href="#fig-wavebands-short" class="quarto-xref">Figure&nbsp;1</a> are one approximation out of several available. We follow the ISO and CIE standards when applicable. The electromagnetic spectrum is continuous with no clear boundaries between one colour and the next. Colours are the result of the interaction of different wavelengths of radiation with the photoreceptor pigments in the eye and the processing of the stimuli by the brain. Alternative definitions based on other sensory systems or energy capture systems are available, some of them applicable to plants.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-wavebands-short" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-wavebands-short-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="BTV2-radiaition-and-optics_files/figure-html/fig-wavebands-short-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wavebands-short-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: The solar spectrum, <span class="math inline">\(280-900\,\mathrm{nm}\)</span>, and different commonly used <em>named</em> wavebands. The solar spectrum at ground level for 1.5 air masses (ASTM G173 standard) and, from top to bottom, human-vision colours according to ISO XXXXX, UV and IR bands according to ISO XXXX, UV and IR bands according to CIE, colours as frequently defined in plant photobiology (following Sellaro20xx and Smith19XX), and PAR (McCree 1971).
</figcaption>
</figure>
</div>
</div>
</div>
<p>Different regions or <em>wavebands</em> of UV and IR radiation are also shown in <a href="#fig-wavebands-short" class="quarto-xref">Figure&nbsp;1</a>, but only in the proximity of visible radiation. In <a href="#fig-wavebands-all" class="quarto-xref">Figure&nbsp;2</a> they are shown for a wider range of wavelengths. It is important to keep in mind that the ISO and CIE definitions of the VIS and UV wavebands overlap. Thus, it is incorrect to sum VIS and UV irradiances, while the definitions of photosynthetically active radiation (PAR) and UV do not overlap. Especially in the IR region the subdivision is somewhat arbitrary and the boundaries used in the literature vary, with differences even between ISO and CIE standards.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-wavebands-all" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-wavebands-all-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="BTV2-radiaition-and-optics_files/figure-html/fig-wavebands-all-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wavebands-all-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: The solar spectrum, <span class="math inline">\(250-3000\,\mathrm{nm}\)</span>, and different commonly used <em>named</em> wavebands. The solar spectrum at ground level for 1.5 air masses (ASTM G173 standard) and, from top to bottom, visible light according to ISO XXXXX and CIE, UV and IR bands according to ISO XXXX, UV and IR bands according to CIE, PAR (McCree1971) and ePAR (Zhen2021).
</figcaption>
</figure>
</div>
</div>
</div>
<p>The energy of a quantum of radiation in a vacuum, depends on the wavelength, <span class="math inline">\(\lambda\)</span>, or frequency<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, <span class="math inline">\(\nu\)</span>,</p>
<p><span class="math display">\[q = h \cdot \nu = h \cdot \frac{c}{\lambda}\]</span></p>
<p>with the Planck constant <span class="math inline">\(h=6.626\times 10^{-34}\,\mathrm{J\,s}\)</span> and speed of light in vacuum <span class="math inline">\(c=2.998\times 10^{8}\,\mathrm{m}\,\mathrm{s}^{-1}\)</span>. When dealing with numbers of photons, the equation above can be extended by using Avogadro’s number <span class="math inline">\(N_\mathrm{A}=6.022\times 10^{23}\)</span> mol<span class="math inline">\(^{-1}\)</span>. Thus, the energy of one mole of photons, <span class="math inline">\(q^\prime\)</span>, is</p>
<p><span class="math display">\[q^\prime = h^\prime \cdot \nu = h^\prime \cdot \frac{c}{\lambda}\]</span> with <span class="math inline">\(h'=h\cdot N_\mathrm{A}=3.990\times 10^{-10}\,\mathrm{J\,s\,mol}^{-1}\)</span>.</p>
<p>The two equations above, are valid for all kinds of electromagnetic waves.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
examples
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Example 1:</strong> red light at 600 nm has about 200 kJ mol<span class="math inline">\(^{-1}\)</span>, therefore, 1 <span class="math inline">\(\mu\)</span>mol photons has 0.2 J. <strong>Example 2:</strong> radiation at 300 nm has about 400 kJ mol<span class="math inline">\(^{-1}\)</span>, therefore, 1 <span class="math inline">\(\mu\)</span>mol photons has 0.4 J.</p>
</div>
</div>
</section>
<section id="angle-of-incidence" class="level2">
<h2 class="anchored" data-anchor-id="angle-of-incidence">Angle of Incidence</h2>
<p>Most frequently we describe the flux of radiation on a plane, usually, but not always a horizontal plane <a href="#fig-cosine" class="quarto-xref">Figure&nbsp;3</a>. This called <em>irradiance</em> and expressed per unit area and unit time. The area used as a reference is that of the receiving plane. Fluence rate is measured on the surface of a sphere instead of a plane. This plane is located in three-dimensional (3D) space and when considering a point source of radiation, the angle, <span class="math inline">\(\alpha\)</span>, between the light beam and the receiving plane or surface affects the received irradiance. Both irradiance and fluence rate are fluxes of radiation, expressed per unit area and unit time <a href="#fig-cosine" class="quarto-xref">Figure&nbsp;3</a>.</p>
<div id="fig-cosine" class="quarto-figure quarto-figure-center quarto-float anchored" alt="Diagram" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cosine-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/cosine_arrows.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%" alt="Diagram">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cosine-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: The concepts of irradiance and fluence rate explained. (A) A beam of radiation perpendicular to the plane of an irradiance sensor; irradiance and fluence rate have the same numerical value. (B) Radiation beam at an angle to the irradiance sensor; irradiance has a smaller numerical value than fluence rate. (C) Perfectly diffuse radiation from the hemisphere above the irradiance sensor; the numerical value of irradiance is one half that of fluence rate. (D) Perfectly diffuse radiation from both hemispheres, both above and below the sensors; the numerical value of irradiance is one quarter that of fluence rate. A spherical sensor (left) measures fluence rate, and a one-sided planar sensor (right) measures irradiance. In (A) and (B) radiation is collimated and represented by parallel arrows. In (C) and (D) radiation is diffuse and represented by “randomly” oriented arrows. In (A), (B) and (C) the shaded hemisphere of the spherical sensor is grey.
</figcaption>
</figure>
</div>
<p>The sun, can be assumed to be a point source (the solar disk is <span class="math inline">\(\approx 1 ^\circ\)</span> in diameter when seen from Earth). Changes in distance that are of interest when studying plants are extremely small relative to the total Sun to Earth distance and can be ignored. Thus, in the case of direct sunlight, we have to consider only the angle of incidence. For a given light source the maximum irradiance is that received on a plane normal to the light beam <a href="#fig-cosine" class="quarto-xref">Figure&nbsp;3</a>. As the angle between the beam and the surface becomes shallower, the irradiance measured on the plane decreases, reaching zero, when the beam is parallel to the surface. The relationship between the normal area and that at a shallower angle is given by the cosine of the angle <span class="math inline">\(\alpha\)</span>. When considering the sun, if the receiving plane is horizontal, the angle of interest is the zenith angle (1 - solar elevation angle) <a href="#fig-azimuth" class="quarto-xref">Figure&nbsp;4</a>. If the plane is not horizontal, the angle between the plane and the light beam depends both the the zenith angle and the azimuth angle of the sun’s position, and the effective angle needs to be computed in three dimensions.</p>
<div id="fig-azimuth" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-azimuth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/Azimuth-Altitude_schematic.svg" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-azimuth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Asimuth and elevation (= Altitude) angles (<strong>diagram to be redrawn or edited!</strong>). If the plane on which irradiance is measured is horizontal, the Azimuth angle does not affect the incident angle, and it is enough to only take into account the elevation angle. <em>By TWCarlson</em> - Azimut altitude.svg, CC BY-SA 3.0 <a href="https://commons.wikimedia.org/w/index.php?curid=17727911">file at wikimedia.org</a>.
</figcaption>
</figure>
</div>
<p>Obviously, the discussion above ignored scattered radiation from the sky. One approach to the simulation of the light field when multiple sources or sources with a large emitting area are present, is to use ray tracing, which is essentially a divide and conquer approach.</p>
<p>When we considered <em>a point source</em> like a bare LED chip or light from a small light bulb at a relatively short distance from the receiving plane, distance cannot be ignored as done above for the sun, as the illuminated area increases four times for each doubling in the distance. Thus, each doubling in distance decreases irradiance by 75%.</p>
<p>In the case of light sources with a large surface relative to the illuminated area or light beams focused by a lens or reflector, the rate of increase in area is smaller than for a point source. The extreme case is a highly collimated laser beam, for which the illuminated area increases very slowly with increasing distance. The irradiance, in these cases, is frequently not uniform within the illuminated area, with in most cases higher iradiance at the centre than at the edges of the illuminated area.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Using a lens or reflector to make a light beam narrower makes it possible to increase irradiance by concentrating the light energy onto a smaller illuminated area, and this effect can be quantitatively large. Alternatively, the narrower beam makes it possible to move the light source away from the illuminated object maintaining the same irradiance. This can provide additional space for other equipment, or when using selective reflectors that transmit infrared radiation and only reflect VIS and/or UV radiation reduce the heat load on the illuminated object.</p>
</div>
</div>
<p>In a perfectly collimated beam, the photons follow parallel trajectories. In a beam from a ideal point source the trajectories of the photons are equally probably in all directions (away from the centre of an imaginary sphere). Most real light sources behave somewhere inbetween these extremes.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Angle of Incidence in 3D
</div>
</div>
<div class="callout-body-container callout-body">
<p>While in above, we had the sensor or observer at the centre, and the light source located on an imaginary sphere, here, instead, we locate the point light source at the centre of the sphere. So, when a beam or the radiation passing into a space or sphere is analysed, two important parameters are necessary: the distance to the source and the position of the measurement plane—i.e., if the receiving surface is perpendicular to the beam or at a shallower angle. The geometry is illustrated in <a href="#fig-space" class="quarto-xref">Figure&nbsp;5</a>. The radiation is received at distance <span class="math inline">\(r\)</span> by a surface of area d<span class="math inline">\(A\)</span>, tilted by an angle <span class="math inline">\(\alpha\)</span> to the unit sphere’s surface element, a solid angle, d<span class="math inline">\(\Omega\)</span>, which is a two-dimensional angle in a space. The relation between d<span class="math inline">\(A\)</span> and d<span class="math inline">\(\Omega\)</span> in spherical coordinates is geometrically explained in <a href="#fig-space" class="quarto-xref">Figure&nbsp;5</a>.</p>
<div id="fig-space" class="quarto-figure quarto-figure-center quarto-float anchored" alt="Diagram" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-space-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/sphere.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:67.0%" alt="Diagram">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-space-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Definition of the solid angle dΩ and the geometry of areas in the space (redrawn after Eichler et al., 1993), where the given solid angle dΩ remains the same, regardless of distance r , while the exposed area exemplified by dA will change with distance r from the origin (light source) and the angle α, if the exposed area (or detector) is tilted. The angle denoted by φ is the azimuth angle and θ is the zenith angle.
</figcaption>
</figure>
</div>
<p>The solid angle is calculated from the zenith angle <span class="math inline">\(\theta\)</span> and azimuth angle <span class="math inline">\(\phi\)</span>, which denote the direction of the radiation beam</p>
<p><span class="math display">\[{\rm d}\Omega = {\rm d}\theta\cdot\sin\theta{\rm d}\phi \label{equ_dsolidangle}\]</span> The area of the receiving surface is calculated by a combination of the solid angle of the beam, the distance <span class="math inline">\(r\)</span> from the radiation source and the angle <span class="math inline">\(\alpha\)</span> of the tilt:</p>
<p><span class="math display">\[{\rm d}A  =  \frac{r{\rm d}\theta}{\cos\alpha}\cdot r\sin\theta{\rm d}\phi\]</span> which can be rearranged to</p>
<p><span class="math display">\[\Rightarrow {\rm d}A  =  \frac{r^2}{\cos\alpha}\quad{\rm d}\Omega\]</span> Thus, the solid angle is given by</p>
<p><span class="math display">\[\Omega = \int_A \frac{{\rm d}A\cdot\cos\alpha}{r^2} \label{equ_solidangle}\]</span> The unit of the solid angle is a steradian (sr). The solid angle of an entire sphere is calculated by integration of the equation above over the zenith (<span class="math inline">\(\theta\)</span>) and azimuth (<span class="math inline">\(\phi\)</span>) angles, <span class="math inline">\(0\le\theta\le\pi(180^\circ)\)</span> and <span class="math inline">\(0\le\phi\le2\pi(360^\circ)\)</span>, and is <span class="math inline">\(4\pi\)</span> sr.</p>
</div>
</div>
</section>
<section id="interactions-of-light-and-matter" class="level2">
<h2 class="anchored" data-anchor-id="interactions-of-light-and-matter">Interactions of Light and Matter</h2>
<p>Collimated light reflected from a mirror surface remains collimated, while its direction changes. Light reflected from a white surface is scattered, and if previously collimated, after being reflected it becomes more diffuse, i.e., it leaves the surface in multiple directions. A black surface does not reflect the incident light. A clear or transparent object transmits all the light incident on its surface, similarly to reflection from mirrors and white surfaces, a clear object can scatter the light passing through it or not. Real objects share some of the properties of these theoretical objects. The atmosphere is not perfectly clear and does partly scatter and partly absorb radiation, depending on the wavelength of the incoming or outgoing radiation. The same applies to water. In both cases, interactions take place as the light travels through them, as well as at the interface between media with different refractive index.</p>
<p>Even if continuous, we can conceptually divide media into layers to describe the phenomena. Here we consider a layer between horizontal planes <span class="math inline">\(z_0\)</span> and <span class="math inline">\(z_1\)</span>. The processes responsible for the variation of the radiance <span class="math inline">\(L(\lambda,\theta,\phi)\)</span> as the radiation beam travels through a material, are primarily absorption <span class="math inline">\(a\)</span> and scattering <span class="math inline">\(b\)</span>, which are called inherent optical properties, because they depend only on the characteristics of the material itself and are independent of the light field. Radiance is added to the directly transmitted beam, coming from different directions, due to elastic scattering, by which a photon changes direction but not wavelength or energy level. An example of this is Raleigh scattering in very small particles, which causes the scattering of light in a rainbow. A further gain of radiance into the direct path is due to inelastic processes like fluorescence, where a photon is absorbed by the material and reemitted as a photon with a longer wavelength and lower energy level, and Raman scattering. The elastic and inelastic scattered radiance is denoted as <span class="math inline">\(L^E\)</span> and <span class="math inline">\(L^I\)</span>, respectively. Internal sources of radiances, <span class="math inline">\(L^S\)</span>, like bioluminescence of biological organisms or cells contribute also to the detected radiance. The path of the radiance through a thin horizontal layer with thickness d<span class="math inline">\(z=z_1-z_0\)</span> is shown schematically in <a href="#fig-radtrans" class="quarto-xref">Figure&nbsp;6</a>.</p>
<div id="fig-radtrans" class="quarto-figure quarto-figure-center quarto-float anchored" alt="Diagram" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-radtrans-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/light-path-radiance.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:67.0%" alt="Diagram">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-radtrans-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Path of the radiance and influences of absorbing and scattering particles in a thin homogeneous horizontal layer of air or water. The layer is separated from other layers of different characteristics by boundary lines at height <span class="math inline">\(z_0\)</span> and <span class="math inline">\(z_1\)</span>.
</figcaption>
</figure>
</div>
<p>At the boundary between two materials with different refractive index, the direction of the light bean changes, and depending on the difference in refractive index and the angle of incidence, a varying fraction of the incident light is reflected at the interface (<a href="#fig-refl-vs-angle" class="quarto-xref">Figure&nbsp;7</a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-refl-vs-angle" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-refl-vs-angle-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="BTV2-radiaition-and-optics_files/figure-html/fig-refl-vs-angle-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-refl-vs-angle-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Reflectance of a crown glass or acrylic pane in air as a function of the angle of incidence of light. The dark grey area under the dashed line describes the light reflected by the air to glass (or entrance) interface and the pale grey area describes the light reflected at the glass to air (or exit) interface and the solid line the sum of them. The minimum reflectance at the first interface is 4%. Computed based on a refractive index (<span class="math inline">\(n\)</span>) difference of 1.5, ignoring the higher order reflections of light bouncing back and forth within the glass.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Examples
</div>
</div>
<div class="callout-body-container callout-body">
<p>The fraction of the incident light reflected by the glass or plastic roof of a greenhouse depends on the angle of incidence of the light, making the orientation and inclination of the roof play an role important in determining the transmittance of daylight at different times of the day.</p>
<p>The same applies to plastic films and sheets used to filter-out UV radiation in field experiemnts: the transmittance of the filters will vary during the course of the day, reflecting proportionally more PAR when the angle of incidence of sunlight is shallower.</p>
<p>The surface of a water body reflects more light when the sun is low in the sky than at noon, at least if the surface of the water is horizontal and undisturbed by waves.</p>
</div>
</div>
</section>
<section id="radiative-transfer" class="level2">
<h2 class="anchored" data-anchor-id="radiative-transfer">Radiative Transfer</h2>
<p>Putting all this together, the radiative transfer equation is <span class="math display">\[\cos\theta\,\frac{{\rm d}L}{{\rm d}z} = -(a+b)\cdot L + L^E + L^I + L^S \label{equ_rte}\]</span> The dependencies of <span class="math inline">\(L\)</span> on <span class="math inline">\(\lambda\)</span>, <span class="math inline">\(\theta\)</span>, and <span class="math inline">\(\phi\)</span> are omitted here for brevity. No exact analytical solution to the radiative transfer equation exists, hence it is necessary either to use numerical models or to make approximations and find an analytical parameterisation. A numerical model is for example the Monte Carlo method. The parameters of the light field can be simulated by modelling the paths of photons. For an infinite number of photons the light field parameters reach their exact values asymptotically. The advantage of the Monte Carlo method is a relatively simple structure of the program, and it simulates nature in a straightforward way, but its disadvantage is the time-consuming computation involved. Details of the Monte Carlo method are explained for example by <span class="citation" data-cites="prahl89">(<a href="#ref-prahl89" role="doc-biblioref"><strong>prahl89?</strong></a>)</span>, <span class="citation" data-cites="Wang1995">(<a href="#ref-Wang1995" role="doc-biblioref"><strong>Wang1995?</strong></a>)</span><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>, or <span class="citation" data-cites="moble94">(<a href="#ref-moble94" role="doc-biblioref"><strong>moble94?</strong></a>)</span>.</p>
<p>The other way to solve the radiative transfer equation is through the development of analytical parameterisations by making approximations for all the quantities needed. In this case, the result is not exact, but it has the advantage of fast computing and the analytical equations can be inverted just as fast. This leads to the idealised case of a source-free (<span class="math inline">\(L^S=0\)</span>) and non-scattering media, i.e., <span class="math inline">\(b=0\)</span> and therefore <span class="math inline">\(L^E=L^I=0\)</span>. Then, equation XXXX can be integrated easily to yield</p>
<p><span class="math display">\[L(z_1) = L(z_0)\cdot \mathrm{e}^{-\frac{a\cdot(z_1-z_0)}{\cos\theta}}\]</span></p>
<p>The radiance value at the upper boundary, <span class="math inline">\(L(z_0)\)</span>, is presumed known. This equation is known as Beer’s law (or Lambert’s law, Bouguer’s law, Beer-Lambert law), and describes any instance of exponential attenuation of light and is exact only for purely absorbing media—i.e., media that do not scatter radiation. It is of direct application in analytical chemistry, as it describes the direct proportionality of absorbance (<span class="math inline">\(A\)</span>) to the concentration of a “coloured” solute in a transparent solvent. True solutions are optically homogeneous, while suspensions and aerosols are not. The latter scatter light and their behaviour is different from that described by Beer’s law. In chemistry, Beer’s law is formulated in a simplified way by assuming a collimated light beam incident at 90 degrees</p>
<p><span class="math display">\[I_\lambda(z_1) = I_\lambda(z_0) \cdot \mathrm{e}^{-k_\lambda\cdot c\cdot l}\]</span> where <span class="math inline">\(I_\lambda(z_0)\)</span> and <span class="math inline">\(I_\lambda(z_1)\)</span> are irradiances, <span class="math inline">\(k_\lambda\)</span> is the attenuation coefficient of the solute, <span class="math inline">\(c\)</span> is the concentration of the solute, and <span class="math inline">\(l = z_1 - z_0\)</span> is the path length. As the value of <span class="math inline">\(k_\lambda\)</span> is a function of wavelength, <span class="math inline">\(\lambda\)</span>, how much <span class="math inline">\(I\)</span> is attenuated also depends on <span class="math inline">\(\lambda\)</span>.</p>
</section>
<section id="radiation-quantities" class="level2">
<h2 class="anchored" data-anchor-id="radiation-quantities">Radiation Quantities</h2>
<p>The amount of radiation can be quantified in different ways. Each quantity is useful in different circumstances. Quantities can describe flows (energy per unit time), flux rates (energy per unit time and unit area), exposure (energy per event and unit area), radiant flux (energy per unit time) and radiance (energy per unit area and solid angle). The shape of the receiving surface can be a plane, a sphere, a hemisphere or even a cylinder. In the case of radiance, the angle of acceptance of the sensor can also vary but usually narrow. These definitions are independent of wavelengths, but the quantities are in most cases used to describe energy integrated over a certain range of wavelengths based on the “named” wavebands shown in <a href="#fig-wavebands-short" class="quarto-xref">Figure&nbsp;1</a> and <a href="#fig-wavebands-all" class="quarto-xref">Figure&nbsp;2</a>. The definitions and symbols used for several physical quantities used to describe the “amount of radiation” are given in <span class="citation" data-cites="tab-energy-quantites">(<a href="#ref-tab-energy-quantites" role="doc-biblioref"><strong>tab-energy-quantites?</strong></a>)</span>.</p>
<div class="table*">
<div class="center">
<table class="table">
<colgroup>
<col style="width: 34%">
<col style="width: 26%">
<col style="width: 39%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Symbol</th>
<th style="text-align: center;">Unit</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\Phi=\frac{\partial \quantum}{\partial t}\)</span></td>
<td style="text-align: center;">W = J s<span class="math inline">\(^{-1}\)</span></td>
<td style="text-align: left;">Radiant flux: absorbed or emitted energy per time interval</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\exposure=\frac{\partial \quantum}{\partial A}\)</span></td>
<td style="text-align: center;">J m<span class="math inline">\(^{-2}\)</span></td>
<td style="text-align: left;">Exposure: energy towards a surface area. (In plant research this is called usually <em>dose</em> (), while in Physics <em>dose</em> refers to absorbed radiation.)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\irr=\frac{\partial \Phi}{\partial A}\)</span></td>
<td style="text-align: center;">W m<span class="math inline">\(^{-2}\)</span></td>
<td style="text-align: left;">Irradiance: flux or radiation towards a surface area, radiant flux density</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\intensity=\frac{\partial \Phi}{\partial\Omega}\)</span></td>
<td style="text-align: center;">W sr<span class="math inline">\(^{-1}\)</span></td>
<td style="text-align: left;">Radiant intensity: emitted radiant flux of a surface area per solid angle</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\emitt=\frac{\partial \Phi}{\partial A}\)</span></td>
<td style="text-align: center;">W m<span class="math inline">\(^{-2}\)</span></td>
<td style="text-align: left;">Emittance: emitted radiant flux per surface area</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\radiance=\frac{\partial^2 \Phi}{\partial \Omega (\partial A\cdot \cos\alpha)}=\frac{\partial \intensity}{\partial A\cdot\cos\alpha}\)</span></td>
<td style="text-align: center;">W m<span class="math inline">\(^{-2}\)</span> sr<span class="math inline">\(^{-1}\)</span></td>
<td style="text-align: left;">Radiance: emitted radiant flux per solid angle and surface area depending on the angle between radiant flux and surface perpendicular</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Taking into account Equation <a href="#equ_solidangle" data-reference-type="ref" data-reference="equ_solidangle">[equ_solidangle]</a> and assuming a homogenous flux, the important correlation between irradiance <span class="math inline">\(\irr\)</span> and intensity <span class="math inline">\(\intensity\)</span> is <span class="math display">\[E = \frac{\intensity \cdot \cos\alpha}{r^2} \label{equ_r2law}\]</span> The irradiance decreases by the square of the distance to the source and depends on the tilt of the detecting surface area. This is valid only for point sources. For outdoor measurements the sun can be assumed to be a point source. For artificial light sources simple LEDs (light-emitting diodes) without optics on top are also effectively point sources. However, LEDs with optics—and other artificial light sources with optics or reflectors designed to give a more focused dispersal of the light—deviate to various extents from the rule of a decrease of irradiance proportional to the square of the distance from the light source.</p>
<p>Besides the physical quantities used for all electromagnetic radiation, there are also equivalent quantities to describe visible radiation, so called photometric quantities. The human eye as a detector led to these photometric units, and they are commonly used by lamp manufacturers to describe their artificial light sources. See Box <a href="#box:photometric:quantities" data-reference-type="ref" data-reference="box:photometric:quantities">[box:photometric:quantities]</a> on page for a short description of these quantities and units.</p>
<div class="example*">

</div>
<div class="example*">
<div class="shaded">
<p>When we are interested in photochemical reactions, the most relevant radiation quantities are those expressed in photons. The reason for this is that, as discussed in section <a href="#sec:photobio:principles" data-reference-type="ref" data-reference="sec:photobio:principles">1.2</a> on page , molecules are excited by the absorption of certain fixed amounts of energy or quanta. The surplus energy “decays” by non-photochemical processes. When studying photosynthesis, where many photons of different wavelengths are simultaneously important, we normally use photon irradiance to describe amount of . The name photosynthetic photon flux density, or , is also frequently used when referring to photon irradiance. When dealing with energy balance of an object instead of photochemistry, we use (energy) irradiance. In meteorology both and visible radiation, are quantified using energy-based quantities. When dealing with photochemistry as in responses mediated by UVR8, an photoreceptor, the use of quantum quantities is preferred. According to the physical energetic quantities in the table <a href="#tab:Phys:Quants" data-reference-type="ref" data-reference="tab:Phys:Quants">[tab:Phys:Quants]</a>, the equivalent photon related quantities are listed in the table below and have the subscript <span class="math inline">\(\mathrm{p}\)</span>.</p>
<p><strong>Table.</strong> Photon quantities of light.</p>
<div class="center">
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Symbol</th>
<th style="text-align: center;">Unit</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\Phi_\mathrm{p}\)</span></td>
<td style="text-align: center;">s<span class="math inline">\(^{-1}\)</span></td>
<td style="text-align: left;">Photon flux: number of photons per time interval</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\pfd=\frac{\partial \Phi_\mathrm{p}}{\partial A}\)</span></td>
<td style="text-align: center;">m<span class="math inline">\(^{-2}\)</span> s<span class="math inline">\(^{-1}\)</span></td>
<td style="text-align: left;">Photon irradiance: photon flux towards a surface area, photon flux density (sometimes also symbolised by <span class="math inline">\(\irr[p]\)</span>)</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\qdose=\int_t\;\pfd\;\mathrm{d}t\)</span></td>
<td style="text-align: center;">m<span class="math inline">\(^{-2}\)</span></td>
<td style="text-align: left;">Photon exposure: number of photons towards a surface area during a time interval, photon fluence</td>
</tr>
</tbody>
</table>
</div>
<p>These quantities can be also used based on a ‘chemical’ amount of moles by dividing the quantities by Avogadro’s number <span class="math inline">\(N_A=6.022\times 10^{23}\)</span> mol<span class="math inline">\(^{-1}\)</span>. To determine a quantity in terms of photons, an energetic quantity has to be weighted by the number of photons, i.e.&nbsp;divided by the energy of a single photon at each wavelength as defined in equation <a href="#equ_energy" data-reference-type="ref" data-reference="equ_energy">[equ_energy]</a>. This yields for example <span class="math display">\[\Phi_\mathrm{p} = \frac{\lambda}{h\;c}\cdot\frac{\partial\quantum}{\partial t}\hspace{1cm}\mathrm{and}\hspace{1cm}\pfd(\lambda) = \frac{\lambda}{h\;c}\cdot E(\lambda)\]</span> When dealing with bands of wavelengths, for example an integrated value like from 400 to 700&nbsp;nm, it is necessary to repeat these calculations at each wavelength and then integrate over the wavelengths. For example, the photon irradiance or in moles of photons is obtained by <span class="math display">\[\PPFD = \frac{1}{N_\mathrm{A}}\int_{400\;\mathrm{nm}}^{700\,\mathrm{nm}}\frac{\lambda}{hc}\;E(\lambda)\;\mathrm{d}\lambda\]</span> For integrated values of or radiation the calculation is done analogously by integrating from 280 to 315&nbsp;nm or 315 to 400&nbsp;nm, respectively.</p>
<p>If we have measured (energy) irradiance, and want to convert this value to photon irradiance, the exact conversion will be possible only if we have information about the spectral composition of the measured radiation. Conversion factors at different wavelengths are given in the table below. For , 1&nbsp;of “average daylight” is approximately 4.6&nbsp;. This is exact only if the radiation is equal from 400 to 700&nbsp;nm, because the factor is the value at the central wavelength at 550&nbsp;nm. Further details are discussed in section <a href="#sec:basic:concepts" data-reference-type="ref" data-reference="sec:basic:concepts">[sec:basic:concepts]</a> on page .</p>
<p><strong>Table.</strong> Conversion factors of photon and energy quantities at different wavelengths.</p>
<div class="center">
<table class="table">
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">to</th>
<th style="text-align: center;"><span class="math inline">\(\lambda\)</span> (nm)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td style="text-align: center;">2.34</td>
<td style="text-align: center;">280</td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: center;">2.49</td>
<td style="text-align: center;">298</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">2.63</td>
<td style="text-align: center;">315</td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: center;">2.99</td>
<td style="text-align: center;">358</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">3.34</td>
<td style="text-align: center;">400</td>
</tr>
<tr class="even">
<td></td>
<td style="text-align: center;">4.60</td>
<td style="text-align: center;">550</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: center;">5.85</td>
<td style="text-align: center;">700</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>There are, in principle, two possible approaches to measuring radiation. The first is to observe light from one specific direction or viewing angle, which is the radiance <span class="math inline">\(\radiance\)</span>. The second is to use a detector, which senses radiation from more than one direction and measures the so-called irradiance <span class="math inline">\(\irr\)</span> of the entire sphere or hemisphere. The correlation between irradiance <span class="math inline">\(\irr\)</span> and radiance <span class="math inline">\(\radiance\)</span> of the wavelength <span class="math inline">\(\lambda\)</span> is given by integrating over all directions of incoming photons. <span class="math display">\[\begin{aligned}
\irr[0](\lambda) &amp; = \int_\Omega \radiance(\lambda,\Omega) {\rm d}\Omega \label{equ_E0} \\
\irr(\lambda) &amp; = \int_\Omega \radiance(\lambda,\Omega) |\cos\alpha| {\rm d}\Omega \label{equ_E}
%\end{eqnarray}
\end{aligned}\]</span> Depending on the shape of a detector (which may be either planar or spherical) the irradiance is called (plane) irradiance <span class="math inline">\(\irr\)</span> or fluence rate (also called scalar irradiance) <span class="math inline">\(\flrat\)</span>. A planar sensor detects incoming photons depending on the incident angle and a spherical sensor detects all photons equally weighted for all directions. See section <a href="#sec:basic:concepts" data-reference-type="ref" data-reference="sec:basic:concepts">[sec:basic:concepts]</a> on page for a more detailed discussion.</p>
<p>Here we have discussed the properties of light based on energy quantities. In photobiology there are good reasons to quantify radiation based on photons. See Box <a href="#box:quantum:quantities" data-reference-type="ref" data-reference="box:quantum:quantities">[box:quantum:quantities]</a> on page , and section <a href="#sec:basic:concepts" data-reference-type="ref" data-reference="sec:basic:concepts">[sec:basic:concepts]</a> on page .</p>
</section>
<section id="quantities-describing-light-matter-interactions" class="level2">
<h2 class="anchored" data-anchor-id="quantities-describing-light-matter-interactions">Quantities Describing Light-Matter Interactions</h2>
<p>A, Afr, Tfr, Rfr, n (internal, total, specular, etc.)</p>
</section>
<section id="radiation-and-energy-balances" class="level2">
<h2 class="anchored" data-anchor-id="radiation-and-energy-balances">Radiation and Energy Balances</h2>
<p>Above we discussed mainly optics, i.e., light from the perspective of the radiation and how its flow is altered by interactions with matter. The absorption of energy is also important from the perspective of objects and their temperature.</p>
</section>
<section id="radiation-atoms-and-molecules" class="level2">
<h2 class="anchored" data-anchor-id="radiation-atoms-and-molecules">Radiation, Atoms and Molecules</h2>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>These equations are a system of four partial differential equations describing classical electromagnetism.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Wavelength and frequency are related to each other by the speed of light, according to <span class="math inline">\(\nu = c / \lambda\)</span> where <span class="math inline">\(c\)</span> is speed of light in vacuum. Consequently there are two equivalent formulations for the equations.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Their program is available from the website of <a href="http://omlc.ogi.edu/software/mc/">Oregon Medical Laser Center</a> at <a href="http://omlc.ogi.edu/software/mc/" class="uri">http://omlc.ogi.edu/software/mc/</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>